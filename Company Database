/*
5. Consider the schema for Company Database:
EMPLOYEE (SSN, Name, Address, Sex, Salary, SuperSSN, DNo)
DEPARTMENT (DNo, DName, MgrSSN, MgrStartDate)
DLOCATION (DNo,DLoc)
PROJECT (PNo, PName, PLocation, DNo)
WORKS_ON (SSN, PNo, Hours)
Write SQL queries to
1. Make a list of all project numbers for projects that involve an employee whose last
name is ‘Scott’, either as a worker or as a manager of the department that controls
the project.
2. Show the resulting salaries if every employee working on the ‘IoT’ project is given a
10 percent raise.
3. Find the sum of the salaries of all employees of the ‘Accounts’ department, as well
as the maximum salary, the minimum salary, and the average salary in this
department
4. Retrieve the name of each employee who works on all the projects controlled by
department number 5 (use NOT EXISTS operator). For each department that has
more than five employees, retrieve the department number and the number of its
employees who are making more than Rs. 6,00,000.
*/

CREATE TABLE DEPARTMENT (
DNO INT PRIMARY KEY, DNAME VARCHAR(20), MGR_START_DATE DATE);

CREATE TABLE EMPLOYEE (
SSN INT PRIMARY KEY, FNAME VARCHAR(20), LNAME VARCHAR(20), ADDRESS VARCHAR(20), SEX CHAR(1), SALARY INT, SUPERSSN REFERENCES EMPLOYEE(SSN), 
DNO REFERENCES DEPARTMENT(DNO));

ALTER TABLE DEPARTMENT ADD MGRSSN REFERENCES EMPLOYEE(SSN); 

CREATE TABLE DLOCATION (
DNO REFERENCES DEPARTMENT(DNO), DLOC VARCHAR(20), PRIMARY KEY(DNO,DLOC));

CREATE TABLE PROJECT (
PNO INT PRIMARY KEY, PNAME VARCHAR(20), PLOCATION VARCHAR(20), DNO REFERENCES DEPARTMENT(DNO));

CREATE TABLE WORKS_ON(
SSN REFERENCES EMPLOYEE(SSN), PNO REFERENCES PROJECT(PNO), HOURS INT, PRIMARY KEY(SSN,PNO));


INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1001, 'JOHN', 'SCOTT', 'BANGALORE' ,'M', 650000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1002, 'ELENA', 'GILBERT', 'MUMBAI' ,'F', 400000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1003, 'DAMON', 'SALVATORE', 'MUMBAI' ,'M', 700000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1004, 'SHELDON', 'COOPER', 'BANGALORE' ,'M', 550000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1005, 'SERENA', 'VANDERWOODSEN', 'BANGALORE' ,'F', 800000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1006, 'DAN', 'HUMPHREY', 'BANGALORE' ,'M', 700000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1007, 'CLAY', 'JENSON', 'MUMBAI' ,'M', 350000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1008, 'RACHEL', 'GREEN', 'BANGALORE' ,'F', 750000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1009, 'HANNAH', 'BAKER', 'BANGALORE' ,'F', 350000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES (1010, 'STEPHEN', 'SALVATORE', 'BANGALORE' ,'M', 650000);

INSERT INTO DEPARTMENT VALUES(1,'ACCOUNTS','28-SEP-2020',1001);
INSERT INTO DEPARTMENT VALUES(2,'SALES','25-JUL-2019',1002);
INSERT INTO DEPARTMENT VALUES(3,'PRODUCTION','03-AUG-2018',1003);
INSERT INTO DEPARTMENT VALUES(4,'FINANCE','29-AUG-2020',1004);
INSERT INTO DEPARTMENT VALUES(5,'HR','04-DEC-2018',1005);

UPDATE EMPLOYEE SET SUPERSSN=NULL, DNO=1 WHERE SSN=1001;
UPDATE EMPLOYEE SET SUPERSSN=NULL, DNO=2 WHERE SSN=1002;
UPDATE EMPLOYEE SET SUPERSSN=NULL, DNO=3 WHERE SSN=1003;
UPDATE EMPLOYEE SET SUPERSSN=NULL, DNO=4 WHERE SSN=1004;
UPDATE EMPLOYEE SET SUPERSSN=NULL, DNO=5 WHERE SSN=1005;
UPDATE EMPLOYEE SET SUPERSSN=1001, DNO=1 WHERE SSN=1006;
UPDATE EMPLOYEE SET SUPERSSN=1001, DNO=1 WHERE SSN=1007;
UPDATE EMPLOYEE SET SUPERSSN=1001, DNO=1 WHERE SSN=1008;
UPDATE EMPLOYEE SET SUPERSSN=1001, DNO=1 WHERE SSN=1009;
UPDATE EMPLOYEE SET SUPERSSN=1001, DNO=1 WHERE SSN=1010;

INSERT INTO DLOCATION VALUES(1,'BANGALORE');
INSERT INTO DLOCATION VALUES(2,'MUMBAI');
INSERT INTO DLOCATION VALUES(3,'MUMBAI');
INSERT INTO DLOCATION VALUES(4,'BANGALORE');
INSERT INTO DLOCATION VALUES(5,'BANGALORE');

INSERT INTO PROJECT VALUES(101,'IOT','BANGALORE',1);
INSERT INTO PROJECT VALUES(102,'CLOUD','MUMBAI',2);
INSERT INTO PROJECT VALUES(103,'DBMS','BANGALORE',1);
INSERT INTO PROJECT VALUES(104,'AI','MUMBAI',3);
INSERT INTO PROJECT VALUES(105,'DATA SCIENCE','BANGALORE',4);
INSERT INTO PROJECT VALUES(106,'BIG DATA','BANGALORE',5);

INSERT INTO WORKS_ON VALUES(1001,101,10);                         
INSERT INTO WORKS_ON VALUES(1002,102,12);
INSERT INTO WORKS_ON VALUES(1003,104,15);
INSERT INTO WORKS_ON VALUES(1004,105,11);
INSERT INTO WORKS_ON VALUES(1005,106,13);
INSERT INTO WORKS_ON VALUES(1006,101,15);
INSERT INTO WORKS_ON VALUES(1007,101,10);
INSERT INTO WORKS_ON VALUES(1008,101,12);
INSERT INTO WORKS_ON VALUES(1009,103,15);


SELECT DISTINCT P.PNO
FROM PROJECT P, DEPARTMENT D, EMPLOYEE E
WHERE E.DNO=D.DNO
    AND E.SSN=D.MGRSSN
    AND E.LNAME='SCOTT';
UNION
SELECT DISCTINCT P1.PNO
FROM PROJECT P1, WORKS_ON W, EMPLOYEE E1
WHERE P1.PNO=W.PNO
    AND E1.SSN=W.SSN
    AND E1.LNAME='SCOTT';


/*
PNO
101
102
103
104
105
106
*/


SELECT E.FNAME, E.LNAME, 1.1*SALARY AS INC_SALARY
FROM EMPLOYEE E, WORKS_ON W, PROJECT P
WHERE P.PNAME='IOT'
AND W.PNO=P.PNO
AND E.SSN=W.SSN;

/*
FNAME	LNAME	INC_SALARY
JOHN	SCOTT	715000
DAN	HUMPHREY	770000
CLAY	JENSON	385000
RACHEL	GREEN	825000
*/

SELECT SUM(E.SALARY), MAX(E.SALARY), MIN(E.SALARY), AVG(E.SALARY)
FROM EMPLOYEE E, DEPARTMENT D
WHERE D.DNAME='ACCOUNTS'
AND E.DNO=D.DNO;

/*
SUM(E.SALARY)	MAX(E.SALARY)	MIN(E.SALARY)	AVG(E.SALARY)
3450000	750000	350000	575000
*/

SELECT E.FNAME, E.LNAME
FROM EMPLOYEE E
WHERE NOT EXISTS ((SELECT PNO
                    FROM PROJECT
                    WHERE DNO=5)
                    MINUS
                    (SELECT PNO
                    FROM WORKS_ON
                    WHERE E.SSN=SSN));
/*
FNAME	LNAME
SERENA	VANDERWOODSEN
*/

SELECT D.DNO, COUNT(*)
FROM EMPLOYEE E, DEPARTMENT D
WHERE E.DNO=D.DNO
AND E.SALARY>600000
AND D.DNO IN (SELECT E1.DNO
                FROM EMPLOYEE E1
                GROUP BY E1.DNO
                HAVING COUNT(*)>5)
GROUP BY D.DNO;

/*
DNO	COUNT(*)
1	4
*/
