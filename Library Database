--DBMS Lab Program 1


/*
Consider the following schema for a Library Database:
BOOK(Book_id, Title, Publisher_Name, Pub_Year)
BOOK_AUTHORS(Book_id, Author_Name)
PUBLISHER(Publisher_Name, Address, Phone)
BOOK_COPIES(Book_id, Branch_id, No-of_Copies)
BOOK_LENDING(Book_id, Branch_id, Card_No, Date_Out, Due_Date)
LIBRARY_BRANCH(Branch_id, Branch_Name, Address)
Write SQL queries to
1. Retrieve details of all books in the library – id, title, name of publisher, authors,
number of copies in each branch, etc.
2. Get the particulars of borrowers who have borrowed more than 3 books, but
from Jan 2017 to Jun 2017.
3. Delete a book in BOOK table. Update the contents of other tables to reflect this
data manipulation operation.
4. Partition the BOOK table based on year of publication. Demonstrate its working
with a simple query.
5. Create a view of all books and its number of copies that are currently available
in the Library
*/



--CREATING TABLES

CREATE TABLE PUBLISHER(
PUBLISHER_NAME VARCHAR(20) PRIMARY KEY, ADDRESS VARCHAR(20), PHONE NUMBER(10));

CREATE TABLE BOOK (
BOOK_ID INT PRIMARY KEY,
TITLE VARCHAR(20), 
PUBLISHER_NAME REFERENCES PUBLISHER(PUBLISHER_NAME) ON DELETE CASCADE, PUB_YEAR NUMBER(4));

CREATE TABLE BOOK_AUTHORS (
BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, AUTHOR_NAME VARCHAR(20), PRIMARY KEY(BOOK_ID,AUTHOR_NAME));

CREATE TABLE LIBRARY_BRANCH (
BRANCH_ID INT PRIMARY KEY, BRANCH_NAME VARCHAR(20), ADDRESS VARCHAR(20));

CREATE TABLE BOOK_COPIES (
BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, BRANCH_ID REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
NO_OF_COPIES INT, PRIMARY KEY(BOOK_ID,BRANCH_ID));

CREATE TABLE CARD (
CARD_NO INT PRIMARY KEY);

CREATE TABLE BOOK_LENDING ( 
BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, BRANCH_ID REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
CARD_NO REFERENCES CARD(CARD_NO) ON DELETE CASCADE, DATE_OUT DATE, DUE_DATE DATE, PRIMARY KEY(BOOK_ID, BRANCH_ID, CARD_NO));




--INSERTING VALUES


INSERT INTO PUBLISHER VALUES ('PENGUIN', 'BANGALORE', 9876543212);
INSERT INTO PUBLISHER VALUES ('HARPER', 'MUMBAI', 9876545659);
INSERT INTO PUBLISHER VALUES ('BLACK SWAN', 'KOLKATA', 9996543212);
INSERT INTO PUBLISHER VALUES ('PEARSON', 'DELHI', 9876553282);
INSERT INTO PUBLISHER VALUES ('ATOM', 'SHIMLA', 9877743212);

INSERT INTO BOOK VALUES (1, 'DS', 'PENGUIN',2010);
INSERT INTO BOOK VALUES (2, 'DBMS', 'HARPER',2015);
INSERT INTO BOOK VALUES (3, 'ATC', 'BLACK SWAN',2000);
INSERT INTO BOOK VALUES (4, 'CNS', 'PEARSON',2012);
INSERT INTO BOOK VALUES (5, 'UP', 'ATOM',2007);

INSERT INTO BOOK_AUTHORS VALUES (1, 'JOHN');
INSERT INTO BOOK_AUTHORS VALUES (2, 'DAMON');
INSERT INTO BOOK_AUTHORS VALUES (3, 'CLAY');
INSERT INTO BOOK_AUTHORS VALUES (4, 'LAURA');
INSERT INTO BOOK_AUTHORS VALUES (5, 'JENNY');

INSERT INTO LIBRARY_BRANCH VALUES (100, 'RNSIT', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH VALUES (101, 'IITB', 'MUMBAI');
INSERT INTO LIBRARY_BRANCH VALUES (102, 'KIT', 'KOLKATA');
INSERT INTO LIBRARY_BRANCH VALUES (103, 'DU', 'DELHI');
INSERT INTO LIBRARY_BRANCH VALUES (104, 'SIT', 'SHIMLA');

INSERT INTO BOOK_COPIES VALUES (1,100,20);
INSERT INTO BOOK_COPIES VALUES (2,101,15);
INSERT INTO BOOK_COPIES VALUES (3,103,25);
INSERT INTO BOOK_COPIES VALUES (4,102,14);
INSERT INTO BOOK_COPIES VALUES (5,104,10);

INSERT INTO CARD VALUES (1000);
INSERT INTO CARD VALUES (1001);
INSERT INTO CARD VALUES (1002);
INSERT INTO CARD VALUES (1003);
INSERT INTO CARD VALUES (1004);

INSERT INTO BOOK_LENDING VALUES ( 1,100,1000,'05-JAN-2017','15-JAN-2017');
INSERT INTO BOOK_LENDING VALUES ( 3,103,1000,'15-MAR-2017','25-MAR-2017');
INSERT INTO BOOK_LENDING VALUES ( 5,104,1000,'15-AUG-2017','25-AUG-2017');
INSERT INTO BOOK_LENDING VALUES ( 2, 101, 1004, '28-SEP-2018','10-OCT-2018');
INSERT INTO BOOK_LENDING VALUES (4, 102, 1003, '25-DEC-2019','1-JAN-2020');
INSERT INTO BOOK_LENDING VALUES ( 5,104,1000,'10-JUN-2017','20-JUN-2017');
INSERT INTO BOOK_LENDING VALUES ( 2,101,1000,'15-FEB-2017','25-FEB-2017');
INSERT INTO BOOK_LENDING VALUES ( 5,100,1000,'15-APR-2017','25-APR-2017');


--Queries

/*
1. Retrieve details of all books in the library – id, title, name of publisher, authors,
number of copies in each Programme, etc.
*/


SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME, C.NO_OF_COPIES, L.BRANCH_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID = A.BOOK_ID
    AND B.BOOK_ID = C.BOOK_ID
    AND L.BRANCH_ID = C.BRANCH_ID;
    

/*
BOOK_ID	    TITLE	      PUBLISHER_NAME	AUTHOR_NAME	     NO_OF_COPIES	    BRANCH_ID
1           	DS	         PENGUIN	        JOHN	             20	           100
2	           DBMS	          HARPER	        DAMON	             15	           101
3	            ATC	        BLACK SWAN	      CLAY	             25	           103
4	            CNS	         PEARSON	        LAURA	             14	           102
5	            UP	        ATOM	            JENNY	             10	           104
*/



/*
2. Get the particulars of borrowers who have borrowed more than 3 books, but
from Jan 2017 to Jun 2017.
*/

SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '01-JUL-2017'
GROUP BY CARD_NO
HAVING COUNT(*)>3;

/*
CARD_NO
1000
*/


/*
3. Delete a book in BOOK table. Update the contents of other tables to reflect this
data manipulation operation.
*/


DELETE FROM BOOK
WHERE BOOK_ID = 4;

SELECT * FROM BOOK;

/*
BOOK_ID	  TITLE	 PUBLISHER_NAME	   PUB_YEAR
1	         DS	    PENGUIN	          2010
2	         DBMS	   HARPER	          2015
3	        ATC    	BLACK SWAN	     2000
5	        UP	     ATOM	          2007
*/



/*
4. Partition the BOOK table based on year of publication. Demonstrate its working
with a simple query.
*/


CREATE VIEW PUBLICATION AS
SELECT PUB_YEAR
FROM BOOK;

SELECT * FROM PUBLICATION;

/*
PUB_YEAR
2010
2015
2000
2007
*/


/*
5. Create a view of all books and its number of copies that are currently available
in the Library
*/

CREATE VIEW LIB_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID = C.BOOK_ID
        AND C.BRANCH_ID = L.BRANCH_ID; 
        
SELECT * FROM LIB_BOOKS;

/*
BOOK_ID	     TITLE     	NO_OF_COPIES
1	            DS	          20
2	           DBMS	          15
3	           ATC	          25
5	            UP	          10
*/
